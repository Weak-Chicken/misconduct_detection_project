{% extends 'misconduct_detection_app/layout.html' %}

{% block sideButton %}
    <div class="offset-md-3">
        <a href="#"><button type="button" class="btn btn-outline-secondary btn-lg btn-custom-size disabled">Next</button></a>
        <br><br>
        <a href="\select\"><button type="button" class="btn btn-outline-secondary btn-lg btn-custom-size">Back</button></a>
        <br><br>
        <button type="button" class="btn btn-outline-secondary btn-lg btn-custom-size" data-toggle="modal" data-target="#cancelButton">Cancel</button>
        <br>
    </div>
    
    <hr>
{% endblock %}

{% block content %}
    <div class="container-fluid">
        <div class="row flex-xl-nowrap">
            <div class="col-12 col-md-6 col-lg-6">
                <div class="card border-secondary" style="width: 48rem;" id="segmentDisplayBox">
                    <!-- {% for key, values in segment_files.items %}
                    <div class="card-header">{{ key }}</div>
                    <div class="card-body text-secondary">
                        <p class="card-text">
                            <pre> {{ values }} </pre>
                        </p>
                    </div>
                    {% endfor %} -->
                </div>

            </div>

            <div class="col-12 col-md-6 col-lg-6">
                <div class="card border-secondary" style="width: 48rem;" id="segmentDetailsDisplayBox">
                    <div class="card-body text-secondary text-center">
                        <h5 class="card-title">Select one segment to examine details</h5>
                    </div>
                </div>
            </div>
        </div>
    </div>
{% endblock %}

{% block javaScriptOnPage %}
    <script>
        pageName = "Results";
        const jplag_results = JSON.parse("{{ jplag_results_json_string|escapejs }}");
        const segment_files = JSON.parse("{{ segment_files_json_string|escapejs }}");
        var jplag_submission_number = "{{ jplag_submission_number }}";

        var segment_files_keys = [];
        for (var key in segment_files) {
            if (segment_files.hasOwnProperty(key)) segment_files_keys.push(key);
        }

        for (var i = 0; i < segment_files_keys.length; i++) { 
            var originalCodeSegmentHeader = document.createElement("div");
            originalCodeSegmentHeader.setAttribute("class", "card-header");
            originalCodeSegmentHeader.innerHTML = segment_files_keys[i];

            var originalCodeSegmentBody = document.createElement("div");
            originalCodeSegmentBody.setAttribute("class", "card-body text-secondary");
            var originalCodeSegmentBodyPara = document.createElement("p");
            originalCodeSegmentBodyPara.setAttribute("class", "card-text");
            var originalCodeSegmentBodyParaPre = document.createElement("pre");
            originalCodeSegmentBodyParaPre.innerHTML = segment_files[segment_files_keys[i]];
            originalCodeSegmentBodyPara.appendChild(originalCodeSegmentBodyParaPre);
            originalCodeSegmentBody.appendChild(originalCodeSegmentBodyPara);

            document.getElementById("segmentDisplayBox").appendChild(originalCodeSegmentHeader);
            document.getElementById("segmentDisplayBox").appendChild(originalCodeSegmentBody);
        }

        var jplag_results_keys = [];
        for (var key in jplag_results) {
            if (jplag_results.hasOwnProperty(key)) jplag_results_keys.push(key);
        }

        document.getElementById("segmentDetailsDisplayBox").innerHTML = "";

        jplag_submission_number -= segment_files_keys.length;
        var individual_probabilities = [];
        var joint_probability = 1;
        var expectation = 0;

        for (var i = 0; i < jplag_results_keys.length; i++) {
            var temp_probability = Object.keys(jplag_results[jplag_results_keys[i]]).length / (jplag_submission_number - 1)
            individual_probabilities.push(temp_probability);
            joint_probability *= temp_probability;
        }

        expectation = joint_probability * (jplag_submission_number - 1);

        for (var i = 0; i < jplag_results_keys.length; i++) { 
            var codeSegmentHeader = document.createElement("div");
            codeSegmentHeader.setAttribute("class", "card-header");
            codeSegmentHeader.innerHTML = jplag_results_keys[i];

            // var segment_keys = [];
            // for (var segment_keys in jplag_results[keys]) {      
            //     if (jplag_results[keys].hasOwnProperty(segment_keys)) keys.push(segment_keys);
            // }

            // codeSegmentDetails = document.createElement("div");
            // codeSegmentDetails.setAttribute("class", "card-header")

            document.getElementById("segmentDetailsDisplayBox").appendChild(codeSegmentHeader);
        }

        // jplag_results_json_string["Segment_1"]["misconduct_detection_app\\uploads\\folders\\inf2c-cs\\0\\palin_finder.c"]

    </script>
{% endblock %}